---
deployment:
  tasks:
    # D√©ploiement automatique selon la branche (staging ou main/production)
    - /bin/bash -c "
      BRANCH=$(git branch --show-current);
      if [ \"$BRANCH\" = \"staging\" ]; then
        echo \"üöÄ D√©ploiement STAGING...\";
        rsync -av --delete --exclude='vendor/' --exclude='uploads/' --exclude='.env' /home/najo1022/repositories/yarnflow/backend/ /home/najo1022/staging.yarnflow.fr/api/;
        echo \"‚úÖ Backend staging d√©ploy√© vers staging.yarnflow.fr\";
      elif [ \"$BRANCH\" = \"main\" ]; then
        echo \"üöÄ D√©ploiement PRODUCTION...\";
        rsync -av --delete --exclude='vendor/' --exclude='uploads/' --exclude='.env' /home/najo1022/repositories/yarnflow/backend/ /home/najo1022/public_html/api/;
        echo \"‚úÖ Backend production d√©ploy√© vers yarnflow.fr\";
      else
        echo \"‚ùå ERREUR: Branche '$BRANCH' non autoris√©e pour le d√©ploiement\";
        echo \"Branches autoris√©es: staging, main\";
        exit 1;
      fi
      "

    # Frontend : d√©ploy√© manuellement via FTP (npm run build + upload dist/)
    # (La ligne ci-dessous est comment√©e car dist/ n'est pas dans Git)
    # - /bin/bash -c "rsync -av --delete --exclude='api/' /home/najo1022/repositories/yarnflow/frontend/dist/ /home/najo1022/public_html/"
